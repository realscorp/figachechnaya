.front:
  extends: .init
  variables:
    CODE_DIR: 'frontend'
    WORKINGDIR_ROOT: ${CI_PROJECT_DIR}/${CODE_DIR}
  rules:
    - if: '$CI_PIPELINE_SOURCE != "web"' # Если пайп запущен не вручную через веб-фейс
      changes: # и в коммите были изменены файлы в каталоге сервиса, запускаем джобу автоматически
        - ${CODE_DIR}/**/*
      when: always
    - exists: # В противном случае - запускаем вручную
        - ${CODE_DIR}/**/*
      when: manual

validate/image/front:
  extends: .init
  stage: validate
  allow_failure: true # без этого пайплайн будет постоянно висеть в статусе blocked или running
  image: pipelinecomponents/hadolint:0.23.3
  script:
    - echo
    - cd $WORKINGDIR_ROOT
    - hadolint Dockerfile

# validate/image/figalize:
#   extends: .init
#   stage: validate
#   allow_failure: true # без этого пайплайн будет постоянно висеть в статусе blocked или running
#   image: pipelinecomponents/hadolint:0.23.3
#   variables:
#     WORKINGDIR_ROOT: ${CI_PROJECT_DIR}/microservices/figalize
#   script:
#     - cd $WORKINGDIR_ROOT
#     - hadolint Dockerfile

# validate/image/history:
#   extends: .init
#   stage: validate
#   allow_failure: true # без этого пайплайн будет постоянно висеть в статусе blocked или running
#   image: pipelinecomponents/hadolint:0.23.3
#   variables:
#     WORKINGDIR_ROOT: ${CI_PROJECT_DIR}/microservices/history
#   script:
#     - cd $WORKINGDIR_ROOT
#     - hadolint Dockerfile

# build/image/front:
#   extends: .dockerbuild
#   variables:
#     IMAGE_TAG: front:1.0.0
#     CODE_DIR: 'frontend'
#   rules:
#     - if: '$CI_PIPELINE_SOURCE != "web"' # Если пайп запущен не вручную через веб-фейс
#       changes: # и в коммите были изменены файлы в каталоге сервиса, запускаем джобу автоматически
#         - frontend/**/*
#       when: always
#     - exists: # В противном случае - запускаем вручную
#         - frontend/**/*
#       when: manual
#   needs:
#     - job: validate/image/front

# build/image/figalize:
#   extends: .dockerbuild
#   variables:
#     IMAGE_TAG: figalize:1.0.0
#     CODE_DIR: microservices/figalize
#   rules:
#     - if: '$CI_PIPELINE_SOURCE != "web"' # Если пайп запущен не вручную через веб-фейс
#       changes: # и в коммите были изменены файлы в каталоге сервиса, запускаем джобу автоматически
#         - microservices/figalize/**/*
#       when: always
#     - exists: # В противном случае - запускаем вручную
#         - microservices/figalize/**/*
#       when: manual
#   needs:
#     - job: validate/image/figalize

# build/image/history:
#   extends: .dockerbuild
#   variables:
#     IMAGE_TAG: history:1.0.0
#     CODE_DIR: microservices/history
#   rules:
#     - if: '$CI_PIPELINE_SOURCE != "web"' # Если пайп запущен не вручную через веб-фейс
#       changes: # и в коммите были изменены файлы в каталоге сервиса, запускаем джобу автоматически
#         - microservices/history/**/*
#       when: always
#     - exists: # В противном случае - запускаем вручную
#         - microservices/history/**/*
#       when: manual
#   needs:
#     - job: validate/image/history
